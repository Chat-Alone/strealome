<!DOCTYPE html>
<html lang="zh-CN" class="h-full">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stream Alone - 直播平台</title>

    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Space+Mono:wght@400;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        'inter': ['Inter', 'sans-serif'],
                        'space-mono': ['Space Mono', 'monospace']
                    },
                    colors: {
                        'dark-card': '#0A0A0A',
                        'dark-card-hover': '#1A1A1A',
                    }
                }
            }
        }
    </script>

    <style>
        * {
            transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
        }

        .dark body {
            background-color: #000000;
        }

        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f0f0f0;
        }

        ::-webkit-scrollbar-thumb {
            background: #c0c0c0;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #a0a0a0;
        }

        .dark ::-webkit-scrollbar-track {
            background: #1a1a1a;
        }

        .dark ::-webkit-scrollbar-thumb {
            background: #404040;
        }

        .dark ::-webkit-scrollbar-thumb:hover {
            background: #606060;
        }

        .pagination-button {
            min-width: 2.5rem;
        }
    </style>
</head>

<body class="h-full bg-gray-50 dark:bg-black text-gray-900 dark:text-white font-inter">
    <nav
        class="bg-white dark:bg-black shadow-sm dark:shadow-gray-800 sticky top-0 z-50 border-b border-gray-200 dark:border-gray-800">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center">
                    <h1 class="text-2xl font-bold text-gray-900 dark:text-white">
                        <span class="hidden sm:inline">Stream Alone</span>
                        <span class="inline sm:hidden">SA</span>
                    </h1>
                </div>

                <div class="flex items-center space-x-4">
                    <button id="theme-toggle" aria-label="Toggle theme"
                        class="w-10 h-10 flex items-center justify-center rounded-lg bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">
                        <i class="fas fa-sun text-yellow-500 dark:hidden"></i>
                        <i class="fas fa-moon text-blue-400 hidden dark:inline"></i>
                    </button>

                    <div class="flex items-center space-x-3 text-sm">
                        <div
                            class="bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 px-3 py-1 rounded-full">
                            <i class="fas fa-user mr-1"></i>
                            <span class="font-medium">User123</span>
                        </div>
                        <button
                            class="text-red-600 dark:text-red-400 hover:text-red-700 dark:hover:text-red-300 font-medium">
                            <i class="fas fa-sign-out-alt mr-1"></i>
                            登出
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <section class="mb-12" aria-labelledby="all-rooms-heading">
            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6">
                <h2 id="all-rooms-heading" class="text-2xl font-bold text-gray-900 dark:text-white mb-4 sm:mb-0">
                    热门直播
                </h2>

                <div class="flex flex-col sm:flex-row gap-3">
                    <div class="relative">
                        <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                        <input type="text" id="search-rooms" placeholder="搜索房间名或创建者..."
                            aria-label="Search rooms by name or creator"
                            class="pl-10 pr-4 py-2 w-full sm:w-64 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-[#0A0A0A] text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    <div class="relative">
                        <select id="filter-status" aria-label="Filter rooms by status"
                            class="appearance-none pl-4 pr-10 py-2 w-full sm:w-auto border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-[#0A0A0A] text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="all">所有状态</option>
                            <option value="live">直播中</option>
                            <option value="offline">离线</option>
                        </select>
                        <div
                            class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-3 text-gray-700 dark:text-gray-300">
                            <i class="fas fa-chevron-down text-xs"></i>
                        </div>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 mb-6" id="rooms-grid">
            </div>

            <div id="all-rooms-pagination-controls" class="flex justify-center items-center space-x-2 mt-6">
            </div>
        </section>

        <section aria-labelledby="my-rooms-heading">
            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6">
                <h2 id="my-rooms-heading" class="text-2xl font-bold text-gray-900 dark:text-white mb-4 sm:mb-0">
                    我创建的房间
                </h2>

                <button id="create-room-btn"
                    class="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors">
                    <i class="fas fa-plus mr-2"></i>
                    创建新房间
                </button>
            </div>

            <div
                class="bg-white dark:bg-[#0A0A0A] rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-50 dark:bg-[#1A1A1A]">
                            <tr>
                                <th
                                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                                    房间名</th>
                                <th
                                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                                    创建时间</th>
                                <th
                                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                                    状态</th>
                                <th
                                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                                    操作</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white dark:bg-[#0A0A0A] divide-y divide-gray-200 dark:divide-gray-700"
                            id="my-rooms-tbody">
                        </tbody>
                    </table>
                </div>

                <div id="empty-state" class="hidden text-center py-12">
                    <i class="fas fa-home text-gray-400 text-4xl mb-4"></i>
                    <p class="text-gray-500 dark:text-gray-400 mb-4">您还没有创建任何房间</p>
                    <button
                        class="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors create-room-trigger">
                        <i class="fas fa-plus mr-2"></i>
                        创建第一个房间
                    </button>
                </div>
            </div>

            <div id="my-rooms-pagination-controls" class="flex justify-center items-center space-x-2 mt-6">
            </div>
        </section>
    </main>

    <div id="create-room-modal"
        class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden" role="dialog"
        aria-modal="true" aria-labelledby="create-room-modal-title">
        <div class="bg-white dark:bg-[#0A0A0A] rounded-lg shadow-xl w-full max-w-md">
            <div class="p-6">
                <div class="flex items-center justify-between mb-4">
                    <h3 id="create-room-modal-title" class="text-lg font-semibold text-gray-900 dark:text-white">创建新房间
                    </h3>
                    <button id="close-modal" aria-label="Close create room modal"
                        class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
                        <i class="fas fa-times"></i>
                    </button>
                </div>

                <div class="mb-4">
                    <label for="room-name-input"
                        class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">房间名称</label>
                    <input type="text" id="room-name-input" placeholder="请输入房间名称..."
                        class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-[#0A0A0A] text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>

                <div class="flex space-x-3">
                    <button id="confirm-create-room"
                        class="flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors">
                        创建房间
                    </button>
                    <button id="cancel-create-room"
                        class="flex-1 px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600 rounded-lg font-medium transition-colors">
                        取消
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="delete-confirm-modal"
        class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden" role="dialog"
        aria-modal="true" aria-labelledby="delete-confirm-modal-title">
        <div class="bg-white dark:bg-[#0A0A0A] rounded-lg shadow-xl w-full max-w-md">
            <div class="p-6">
                <div class="flex items-center justify-between mb-4">
                    <h3 id="delete-confirm-modal-title" class="text-lg font-semibold text-gray-900 dark:text-white">确认删除
                    </h3>
                    <button id="close-delete-modal" aria-label="Close delete confirmation modal"
                        class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <p id="delete-confirm-message" class="text-sm text-gray-700 dark:text-gray-300 mb-6">
                    您确定要删除这个房间吗？此操作无法撤销。</p>
                <div class="flex space-x-3">
                    <button id="confirm-delete-room"
                        class="flex-1 px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg font-medium transition-colors">
                        确认删除
                    </button>
                    <button id="cancel-delete-room"
                        class="flex-1 px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600 rounded-lg font-medium transition-colors">
                        取消
                    </button>
                </div>
            </div>
        </div>
    </div>


    <script>
        const AppState = {
            theme: localStorage.getItem('theme') || 'light',
            allRooms: [
                { id: 1, name: '与朋友的游戏时光', creator: '主播张三', createTime: '2024-05-28 10:00 AM', status: 'live', coverImage: 'https://placehold.co/300x200/3498db/ffffff?text=游戏时光' },
                { id: 2, name: '音乐分享会', creator: '音乐达人李四', createTime: '2024-05-28 09:30 AM', status: 'live', coverImage: 'https://placehold.co/300x200/9b59b6/ffffff?text=音乐分享' },
                { id: 3, name: '技术讨论室', creator: '程序员王五', createTime: '2024-05-27 08:00 PM', status: 'offline', coverImage: 'https://placehold.co/300x200/6b7280/ffffff?text=技术讨论' },
                { id: 4, name: '美食制作直播', creator: '厨师赵六', createTime: '2024-05-27 07:00 PM', status: 'offline', coverImage: 'https://placehold.co/300x200/059669/ffffff?text=美食制作' },
                { id: 5, name: '晨间瑜伽练习', creator: '瑜伽导师Alice', createTime: '2024-05-29 07:00 AM', status: 'live', coverImage: 'https://placehold.co/300x200/ec4899/ffffff?text=瑜伽直播' },
                { id: 6, name: '代码审查与重构', creator: '资深架构师Bob', createTime: '2024-05-29 08:00 AM', status: 'offline', coverImage: 'https://placehold.co/300x200/8b5cf6/ffffff?text=代码审查' },
                { id: 7, name: '晚间故事朗读', creator: '故事大王Carol', createTime: '2024-05-28 09:00 PM', status: 'live', coverImage: 'https://placehold.co/300x200/f59e0b/ffffff?text=故事朗读' },
                { id: 8, name: '独立游戏开发日志', creator: '游戏开发者Dave', createTime: '2024-05-28 06:00 PM', status: 'offline', coverImage: 'https://placehold.co/300x200/10b981/ffffff?text=游戏开发' },
                { id: 9, name: '吉他弹唱教学', creator: '吉他手Eve', createTime: '2024-05-29 11:00 AM', status: 'live', coverImage: 'https://placehold.co/300x200/3b82f6/ffffff?text=吉他教学' },
                { id: 10, name: '摄影后期技巧', creator: '摄影师Frank', createTime: '2024-05-27 02:00 PM', status: 'offline', coverImage: 'https://placehold.co/300x200/ef4444/ffffff?text=摄影后期' },
                { id: 11, name: '深度学习研讨会', creator: 'AI研究员Grace', createTime: '2024-05-29 01:00 PM', status: 'live', coverImage: 'https://placehold.co/300x200/6366f1/ffffff?text=AI研讨' },
                { id: 12, name: '家庭烘焙课堂', creator: '烘焙爱好者Hank', createTime: '2024-05-26 04:00 PM', status: 'offline', coverImage: 'https://placehold.co/300x200/d946ef/ffffff?text=家庭烘焙' },
                { id: 13, name: '旅游Vlog分享', creator: '旅行家Ivy', createTime: '2024-05-29 03:00 PM', status: 'live', coverImage: 'https://placehold.co/300x200/06b6d4/ffffff?text=旅游Vlog' },
                { id: 14, name: '播客录制现场', creator: '播客主持人Jack', createTime: '2024-05-25 05:00 PM', status: 'offline', coverImage: 'https://placehold.co/300x200/f97316/ffffff?text=播客录制' }
            ],
            myRooms: [
                { id: 'user_1', name: '我的第一个直播间', createTime: '2024-05-26 03:00 PM', status: 'offline' },
                { id: 'user_2', name: '日常生活分享', createTime: '2024-05-25 11:00 AM', status: 'offline' },
                { id: 'user_3', name: '我的代码学习日记', createTime: '2024-05-24 10:00 AM', status: 'offline' },
                { id: 'user_4', name: '健身打卡直播间', createTime: '2024-05-23 07:00 PM', status: 'offline' },
                { id: 'user_5', name: '周末电影讨论', createTime: '2024-05-22 08:30 PM', status: 'offline' },
                { id: 'user_6', name: '新游戏试玩', createTime: '2024-05-21 09:00 PM', status: 'offline' },
                { id: 'user_7', name: '语言学习交流', createTime: '2024-05-20 05:00 PM', status: 'offline' }
            ],
            allRoomsCurrentPage: 1,
            allRoomsItemsPerPage: 8,
            myRoomsCurrentPage: 1,
            myRoomsItemsPerPage: 5,
            roomIdToDelete: null,
        };

        class ThemeManager {
            constructor() {
                this.init();
            }

            init() {
                this.applyTheme(AppState.theme);
                this.bindEvents();
            }

            applyTheme(theme) {
                const html = document.documentElement;
                if (theme === 'dark') {
                    html.classList.add('dark');
                } else {
                    html.classList.remove('dark');
                }
                AppState.theme = theme;
                localStorage.setItem('theme', theme);
            }

            toggleTheme() {
                const newTheme = AppState.theme === 'light' ? 'dark' : 'light';
                this.applyTheme(newTheme);
            }

            bindEvents() {
                const themeToggleBtn = document.getElementById('theme-toggle');
                if (themeToggleBtn) {
                    themeToggleBtn.addEventListener('click', () => {
                        this.toggleTheme();
                    });
                }
            }
        }

        class RoomManager {
            constructor() {
                this.roomIdToDelete = null;
                this.init();
            }

            init() {
                this.renderAllRooms();
                this.renderMyRooms();
                this.bindEvents();
                this.bindDeleteModalEvents();
            }

            renderAllRooms() {
                const grid = document.getElementById('rooms-grid');
                if (!grid) return;

                const searchInput = document.getElementById('search-rooms');
                const statusFilterSelect = document.getElementById('filter-status');

                const searchTerm = searchInput ? searchInput.value.trim().toLowerCase() : "";
                const statusFilter = statusFilterSelect ? statusFilterSelect.value : "all";

                let filteredRooms = AppState.allRooms.filter(room => {
                    const matchesSearch = room.name.toLowerCase().includes(searchTerm) ||
                        room.creator.toLowerCase().includes(searchTerm);
                    const matchesStatus = statusFilter === 'all' || room.status === statusFilter;
                    return matchesSearch && matchesStatus;
                });

                const startIndex = (AppState.allRoomsCurrentPage - 1) * AppState.allRoomsItemsPerPage;
                const endIndex = startIndex + AppState.allRoomsItemsPerPage;
                const paginatedRooms = filteredRooms.slice(startIndex, endIndex);

                if (paginatedRooms.length === 0 && filteredRooms.length > 0 && AppState.allRoomsCurrentPage > 1) {
                    AppState.allRoomsCurrentPage = Math.ceil(filteredRooms.length / AppState.allRoomsItemsPerPage);
                    this.renderAllRooms();
                    return;
                }

                if (paginatedRooms.length > 0) {
                    grid.innerHTML = paginatedRooms.map(room => this.createRoomCard(room)).join('');
                } else if (searchTerm === "" && statusFilter === "all") {
                    grid.innerHTML = `<p class="col-span-full text-center text-gray-500 dark:text-gray-400 py-8">暂无直播房间。</p>`;
                } else {
                    grid.innerHTML = `<p class="col-span-full text-center text-gray-500 dark:text-gray-400 py-8">没有找到符合条件的房间。</p>`;
                }

                this.renderAllRoomsPagination(filteredRooms.length);
            }

            renderAllRoomsPagination(totalItems) {
                const container = document.getElementById('all-rooms-pagination-controls');
                if (!container) return;

                const currentPage = AppState.allRoomsCurrentPage;
                const itemsPerPage = AppState.allRoomsItemsPerPage;
                const totalPages = Math.ceil(totalItems / itemsPerPage);

                if (totalPages <= 1) {
                    container.innerHTML = '';
                    return;
                }

                let paginationHTML = '';
                paginationHTML += `
                    <button 
                        onclick="window.roomManager.changeAllRoomsPage(${currentPage - 1})" 
                        class="pagination-button px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 ${currentPage === 1 ? 'opacity-50 cursor-not-allowed' : ''}"
                        ${currentPage === 1 ? 'disabled' : ''}
                        aria-label="Previous page"
                    >
                        <i class="fas fa-chevron-left mr-1 sm:mr-2"></i>
                        <span class="hidden sm:inline">上一页</span>
                    </button>
                `;

                for (let i = 1; i <= totalPages; i++) {
                    if (i === currentPage) {
                        paginationHTML += `<span class="pagination-button px-4 py-2 bg-blue-600 text-white rounded-lg font-medium" aria-current="page">${i}</span>`;
                    } else {
                        paginationHTML += `
                            <button 
                                onclick="window.roomManager.changeAllRoomsPage(${i})" 
                                class="pagination-button px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600"
                                aria-label="Go to page ${i}"
                            >
                                ${i}
                            </button>
                        `;
                    }
                }

                paginationHTML += `
                    <button 
                        onclick="window.roomManager.changeAllRoomsPage(${currentPage + 1})" 
                        class="pagination-button px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 ${currentPage === totalPages ? 'opacity-50 cursor-not-allowed' : ''}"
                        ${currentPage === totalPages ? 'disabled' : ''}
                        aria-label="Next page"
                    >
                        <span class="hidden sm:inline">下一页</span>
                        <i class="fas fa-chevron-right ml-1 sm:ml-2"></i>
                    </button>
                `;
                container.innerHTML = paginationHTML;
            }

            changeAllRoomsPage(newPage) {
                AppState.allRoomsCurrentPage = newPage;
                this.renderAllRooms();
            }

            createRoomCard(room) {
                const statusBadge = room.status === 'live'
                    ? '<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200"><span class="w-2 h-2 bg-red-400 rounded-full mr-1 animate-pulse"></span>直播中</span>'
                    : '<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300">离线</span>';

                let coverDisplayHTML;
                if (room.status === 'live') {
                    const liveCoverImageSrc = 'https://placehold.co/300x200/E5E7EB/6B7280?text=300x200';
                    coverDisplayHTML = `<img src="${liveCoverImageSrc}" alt="${room.name}" class="w-full h-full object-cover">`;
                } else {
                    coverDisplayHTML = `
                        <div class="w-full h-full flex items-center justify-center">
                            <i class="fas fa-video-slash text-gray-500 dark:text-gray-400 text-5xl"></i>
                        </div>
                    `;
                }

                return `
                    <div class="bg-white dark:bg-[#0A0A0A] rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden hover:shadow-md transition-shadow">
                        <div class="aspect-video bg-gray-200 dark:bg-gray-800 relative overflow-hidden">
                            ${coverDisplayHTML}
                            ${room.status === 'live' ? '<div class="absolute top-2 left-2"><span class="bg-red-600 text-white px-2 py-1 rounded text-xs font-medium">LIVE</span></div>' : ''}
                        </div>
                        <div class="p-4">
                            <h3 class="font-semibold text-gray-900 dark:text-white mb-2 truncate" title="${room.name}">${room.name}</h3>
                            <p class="text-sm text-gray-600 dark:text-gray-400 mb-1">
                                <i class="fas fa-user mr-1"></i>
                                ${room.creator}
                            </p>
                            <p class="text-sm text-gray-500 dark:text-gray-500 mb-3">
                                <i class="fas fa-clock mr-1"></i>
                                ${room.createTime}
                            </p>
                            <div class="flex justify-between items-center">
                                ${statusBadge}
                                ${room.status === 'live' ? '<button class="px-3 py-1 bg-blue-600 hover:bg-blue-700 text-white text-sm rounded transition-colors">进入房间</button>' : ''}
                            </div>
                        </div>
                    </div>
                `;
            }

            renderMyRooms() {
                const tbody = document.getElementById('my-rooms-tbody');
                const emptyState = document.getElementById('empty-state');

                if (!tbody || !emptyState) return;

                if (AppState.myRooms.length === 0) {
                    tbody.innerHTML = '';
                    emptyState.classList.remove('hidden');
                } else {
                    emptyState.classList.add('hidden');
                    const startIndex = (AppState.myRoomsCurrentPage - 1) * AppState.myRoomsItemsPerPage;
                    const endIndex = startIndex + AppState.myRoomsItemsPerPage;
                    const paginatedMyRooms = AppState.myRooms.slice(startIndex, endIndex);
                    tbody.innerHTML = paginatedMyRooms.map(room => this.createMyRoomRow(room)).join('');
                }
                this.renderMyRoomsPagination(AppState.myRooms.length);
            }

            renderMyRoomsPagination(totalItems) {
                const container = document.getElementById('my-rooms-pagination-controls');
                if (!container) return;

                const currentPage = AppState.myRoomsCurrentPage;
                const itemsPerPage = AppState.myRoomsItemsPerPage;
                const totalPages = Math.ceil(totalItems / itemsPerPage);

                if (totalPages <= 1) {
                    container.innerHTML = '';
                    return;
                }

                let paginationHTML = '';
                paginationHTML += `
                    <button 
                        onclick="window.roomManager.changeMyRoomsPage(${currentPage - 1})" 
                        class="pagination-button px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 ${currentPage === 1 ? 'opacity-50 cursor-not-allowed' : ''}"
                        ${currentPage === 1 ? 'disabled' : ''}
                        aria-label="Previous page for my rooms"
                    >
                        <i class="fas fa-chevron-left mr-1 sm:mr-2"></i>
                        <span class="hidden sm:inline">上一页</span>
                    </button>
                `;

                for (let i = 1; i <= totalPages; i++) {
                    if (i === currentPage) {
                        paginationHTML += `<span class="pagination-button px-4 py-2 bg-blue-600 text-white rounded-lg font-medium" aria-current="page">${i}</span>`;
                    } else {
                        paginationHTML += `
                            <button 
                                onclick="window.roomManager.changeMyRoomsPage(${i})" 
                                class="pagination-button px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600"
                                aria-label="Go to page ${i} of my rooms"
                            >
                                ${i}
                            </button>
                        `;
                    }
                }

                paginationHTML += `
                    <button 
                        onclick="window.roomManager.changeMyRoomsPage(${currentPage + 1})" 
                        class="pagination-button px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 ${currentPage === totalPages ? 'opacity-50 cursor-not-allowed' : ''}"
                        ${currentPage === totalPages ? 'disabled' : ''}
                        aria-label="Next page for my rooms"
                    >
                        <span class="hidden sm:inline">下一页</span>
                        <i class="fas fa-chevron-right ml-1 sm:ml-2"></i>
                    </button>
                `;
                container.innerHTML = paginationHTML;
            }

            changeMyRoomsPage(newPage) {
                AppState.myRoomsCurrentPage = newPage;
                this.renderMyRooms();
            }

            createMyRoomRow(room) {
                const statusBadge = room.status === 'live'
                    ? '<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200"><span class="w-2 h-2 bg-red-400 rounded-full mr-1 animate-pulse"></span>直播中</span>'
                    : '<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300">离线</span>';

                return `
                    <tr class="hover:bg-gray-50 dark:hover:bg-[#1A1A1A]">
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm font-medium text-gray-900 dark:text-white truncate max-w-xs" title="${room.name}">${room.name}</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm text-gray-500 dark:text-gray-400">${room.createTime}</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            ${statusBadge}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                            <div class="flex space-x-2">
                                <button onclick="window.roomManager.copyShareLink('${room.id}', this)" class="text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300" title="Copy share link">
                                    <i class="fas fa-copy mr-1"></i>
                                    复制链接
                                </button>
                                <button onclick="window.roomManager.showDeleteConfirmation('${room.id}', '${room.name.replace(/'/g, "\\'")}')" class="text-red-600 dark:text-red-400 hover:text-red-700 dark:hover:text-red-300" title="Delete room">
                                    <i class="fas fa-trash mr-1"></i>
                                    删除
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            }

            createRoom(roomName) {
                if (!roomName.trim()) {
                    this.showNotification('请输入房间名称', 'error');
                    return;
                }

                const newRoom = {
                    id: 'user_' + Date.now(),
                    name: roomName.trim(),
                    createTime: new Date().toLocaleString('zh-CN', {
                        year: 'numeric', month: '2-digit', day: '2-digit',
                        hour: '2-digit', minute: '2-digit', hour12: true
                    }).replace(/\//g, '-'),
                    status: 'offline'
                };

                AppState.myRooms.unshift(newRoom);
                AppState.myRoomsCurrentPage = 1;
                this.renderMyRooms();
                this.showNotification('房间创建成功！', 'success');
            }

            showDeleteConfirmation(roomId, roomName) {
                this.roomIdToDelete = roomId;
                const modal = document.getElementById('delete-confirm-modal');
                const messageEl = document.getElementById('delete-confirm-message');
                if (modal && messageEl) {
                    messageEl.textContent = `您确定要删除房间 "${roomName}" 吗？此操作无法撤销。`;
                    modal.classList.remove('hidden');
                }
            }

            _performDeleteRoom() {
                if (!this.roomIdToDelete) return;

                AppState.myRooms = AppState.myRooms.filter(room => room.id !== this.roomIdToDelete);

                const totalItems = AppState.myRooms.length;
                const itemsPerPage = AppState.myRoomsItemsPerPage;
                const currentPage = AppState.myRoomsCurrentPage;
                const newTotalPages = totalItems === 0 ? 0 : Math.ceil(totalItems / itemsPerPage);

                if (currentPage > newTotalPages && newTotalPages > 0) {
                    AppState.myRoomsCurrentPage = newTotalPages;
                } else if (totalItems === 0) {
                    AppState.myRoomsCurrentPage = 1;
                }

                this.renderMyRooms();
                this.showNotification('房间已删除', 'info');
                this.roomIdToDelete = null;
            }


            copyShareLink(roomId, buttonElement) {
                const shareLink = `${window.location.origin}${window.location.pathname}?room=${roomId}`;
                const originalButtonHTML = buttonElement.innerHTML;
                const copiedHTML = `<i class="fas fa-check mr-1"></i>已复制`;

                const showCopiedFeedback = () => {
                    buttonElement.innerHTML = copiedHTML;
                    buttonElement.disabled = true;
                    setTimeout(() => {
                        buttonElement.innerHTML = originalButtonHTML;
                        buttonElement.disabled = false;
                    }, 2000);
                };

                if (navigator.clipboard && window.isSecureContext) {
                    navigator.clipboard.writeText(shareLink).then(() => {
                        this.showNotification('链接已复制到剪贴板', 'success');
                        showCopiedFeedback();
                    }).catch((err) => {
                        this.fallbackCopyToClipboard(shareLink, showCopiedFeedback);
                    });
                } else {
                    this.fallbackCopyToClipboard(shareLink, showCopiedFeedback);
                }
            }

            fallbackCopyToClipboard(text, successCallback) {
                const textArea = document.createElement('textarea');
                textArea.value = text;
                textArea.style.position = 'fixed';
                textArea.style.left = '-999999px';
                textArea.style.top = '-999999px';
                document.body.appendChild(textArea);
                textArea.focus();
                textArea.select();

                try {
                    const successful = document.execCommand('copy');
                    if (successful) {
                        this.showNotification('链接已复制到剪贴板 (fallback)', 'success');
                        if (successCallback) successCallback();
                    } else {
                        this.showNotification('复制失败，请手动复制链接', 'error');
                    }
                } catch (err) {
                    this.showNotification('复制失败，请手动复制链接', 'error');
                }

                document.body.removeChild(textArea);
            }

            showNotification(message, type = 'info') {
                const notification = document.createElement('div');
                const typeClasses = {
                    success: 'bg-green-500',
                    error: 'bg-red-500',
                    info: 'bg-blue-500'
                };
                const iconClasses = {
                    success: 'fa-check-circle',
                    error: 'fa-exclamation-triangle',
                    info: 'fa-info-circle'
                };

                notification.className = `fixed top-4 right-4 ${typeClasses[type] || typeClasses.info} text-white px-6 py-3 rounded-lg shadow-lg z-[100] transform translate-x-full transition-transform duration-300 ease-out`;
                notification.innerHTML = `
                    <div class="flex items-center">
                        <i class="fas ${iconClasses[type] || iconClasses.info} mr-2"></i>
                        <span>${message}</span>
                    </div>
                `;

                document.body.appendChild(notification);

                requestAnimationFrame(() => {
                    notification.style.transform = 'translateX(0)';
                });

                setTimeout(() => {
                    notification.style.transform = 'translateX(100%)';
                    setTimeout(() => {
                        if (document.body.contains(notification)) {
                            document.body.removeChild(notification);
                        }
                    }, 300);
                }, 3000);
            }

            bindEvents() {
                const searchInput = document.getElementById('search-rooms');
                if (searchInput) {
                    searchInput.addEventListener('input', () => {
                        AppState.allRoomsCurrentPage = 1;
                        this.renderAllRooms();
                    });
                }

                const filterSelect = document.getElementById('filter-status');
                if (filterSelect) {
                    filterSelect.addEventListener('change', () => {
                        AppState.allRoomsCurrentPage = 1;
                        this.renderAllRooms();
                    });
                }

                const modal = document.getElementById('create-room-modal');
                const createBtn = document.getElementById('create-room-btn');
                const closeBtn = document.getElementById('close-modal');
                const cancelBtn = document.getElementById('cancel-create-room');
                const confirmBtn = document.getElementById('confirm-create-room');
                const roomNameInput = document.getElementById('room-name-input');

                const openModalAction = () => {
                    if (modal && roomNameInput) {
                        modal.classList.remove('hidden');
                        roomNameInput.value = '';
                        roomNameInput.focus();
                    }
                };

                if (createBtn) {
                    createBtn.addEventListener('click', openModalAction);
                }

                const closeModalAction = () => {
                    if (modal && roomNameInput) {
                        modal.classList.add('hidden');
                        roomNameInput.value = '';
                    }
                };

                if (closeBtn) {
                    closeBtn.addEventListener('click', closeModalAction);
                }

                if (cancelBtn) {
                    cancelBtn.addEventListener('click', closeModalAction);
                }

                if (modal) {
                    modal.addEventListener('click', (e) => {
                        if (e.target === modal) {
                            closeModalAction();
                        }
                    });
                }


                if (confirmBtn && roomNameInput) {
                    confirmBtn.addEventListener('click', () => {
                        const roomName = roomNameInput.value;
                        if (roomName.trim()) {
                            this.createRoom(roomName);
                            closeModalAction();
                        } else {
                            this.showNotification('请输入房间名称', 'error');
                            roomNameInput.focus();
                        }
                    });
                }

                if (roomNameInput) {
                    roomNameInput.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter') {
                            const roomName = roomNameInput.value;
                            if (roomName.trim()) {
                                this.createRoom(roomName);
                                closeModalAction();
                            } else {
                                this.showNotification('请输入房间名称', 'error');
                                roomNameInput.focus();
                            }
                        }
                    });
                }

                document.querySelectorAll('.create-room-trigger').forEach(trigger => {
                    trigger.addEventListener('click', openModalAction);
                });
            }

            bindDeleteModalEvents() {
                const deleteModal = document.getElementById('delete-confirm-modal');
                const closeDeleteBtn = document.getElementById('close-delete-modal');
                const cancelDeleteBtn = document.getElementById('cancel-delete-room');
                const confirmDeleteBtn = document.getElementById('confirm-delete-room');

                const closeDeleteModalAction = () => {
                    if (deleteModal) {
                        deleteModal.classList.add('hidden');
                        this.roomIdToDelete = null;
                    }
                };

                if (closeDeleteBtn) {
                    closeDeleteBtn.addEventListener('click', closeDeleteModalAction);
                }
                if (cancelDeleteBtn) {
                    cancelDeleteBtn.addEventListener('click', closeDeleteModalAction);
                }
                if (deleteModal) {
                    deleteModal.addEventListener('click', (e) => {
                        if (e.target === deleteModal) {
                            closeDeleteModalAction();
                        }
                    });
                }


                if (confirmDeleteBtn) {
                    confirmDeleteBtn.addEventListener('click', () => {
                        this._performDeleteRoom();
                        closeDeleteModalAction();
                    });
                }
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            window.themeManager = new ThemeManager();
            window.roomManager = new RoomManager();
        });
    </script>
</body>

</html>